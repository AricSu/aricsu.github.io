# 事务的隔离级别

|事务隔离级别	| 脏读	| 不可重复读	| 幻读 |
| --- | --- | --- | --- |
|读未提交（read-uncommitted）	| 是	| 是	| 是 |
|不可重复读（read-committed）	| 否	| 是	| 是 |
|可重复读（repeatable-read）	| 否	| 否	| 是 |
|串行化（serializable）	| 否	| 否	| 否 |


## 事务的隔离界别实验
本次实验采用postgreSQL

#### 读已经提交CASE实验

更改两个session的隔离级别
```
# session 1
postgres=# set default_transaction_isolation='READ COMMITTED';

# session 1
postgres=# show transaction_isolation;
 transaction_isolation 
-----------------------
 read committed
(1 row)

# session 2
postgres=# set default_transaction_isolation='READ COMMITTED';

# session 2
postgres=# show transaction_isolation;
 transaction_isolation 
-----------------------
 read committed
(1 row)

# session 1
postgres=# create table jan_isolation_test(id int primary key,name varchar(20),age int);

# session 1
postgres=# insert into jan_isolation_test values (1,'jan_1',22),(2,'jan_2',23);
```


```
# session 1
postgres=# begin;
BEGIN

# session 1
postgres=# select * from jan_isolation_test;
 id | name  | age 
----+-------+-----
  1 | jan_1 |  22
  2 | jan_2 |  23
(2 rows)

# session 2
postgres=#  begin;
BEGIN

# session 1
postgres=# select * from jan_isolation_test;
 id | name  | age 
----+-------+-----
  1 | jan_1 |  22
  2 | jan_2 |  23
(2 rows)

# session 1
postgres=# update jan_isolation_test set age=55;
UPDATE 2

# session 1
postgres=# select * from jan_isolation_test;
 id | name  | age 
----+-------+-----
  1 | jan_1 |  55
  2 | jan_2 |  55
(2 rows)

# session 2
postgres=# select * from jan_isolation_test;
 id | name  | age 
----+-------+-----
  1 | jan_1 |  22
  2 | jan_2 |  23
(2 rows)

# session 2
postgres=# insert into jan_isolation_test values(3,'jan_3',23);
INSERT 0 1

# session 2
postgres=# select * from jan_isolation_test;
 id | name  | age 
----+-------+-----
  1 | jan_1 |  55
  2 | jan_2 |  55
  3 | jan_3 |  23
(3 rows)

# session 1
postgres=# select * from jan_isolation_test;
 id | name  | age 
----+-------+-----
  1 | jan_1 |  55
  2 | jan_2 |  55
(2 rows)

# session 2
postgres=# commit;
COMMIT

# session 1
postgres=# select * from jan_isolation_test;
 id | name  | age 
----+-------+-----
  1 | jan_1 |  55
  2 | jan_2 |  55
  3 | jan_3 |  23
(3 rows)

# session 1
postgres=# commit;
COMMIT
```




#### 可重复读CASE实验

改变两个session的隔离级别

 - 出现幻读
```
# session 1
postgres=# set default_transaction_isolation='repeatable read';
SET

# session 1
postgres=#  show transaction_isolation;
 transaction_isolation 
-----------------------
 repeatable read
(1 row)

# session 2
postgres=# set default_transaction_isolation='repeatable read';
SET

# session 2
postgres=#  show transaction_isolation;
 transaction_isolation 
-----------------------
 repeatable read
(1 row)
```

 - 出现不可重复读
```
# session 1
postgres=# set default_transaction_isolation='READ COMMITTED';

# session 1
postgres=# show transaction_isolation;
 transaction_isolation 
-----------------------
 read committed
(1 row)

# session 2
postgres=# set default_transaction_isolation='READ COMMITTED';

# session 2
postgres=# show transaction_isolation;
 transaction_isolation 
-----------------------
 read committed
(1 row)



```