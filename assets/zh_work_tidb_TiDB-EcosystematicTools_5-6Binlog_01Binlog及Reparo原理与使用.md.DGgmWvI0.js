import{_ as i,c as a,o as n,a4 as p}from"./chunks/framework.CGsRFzUA.js";const g=JSON.parse('{"title":"TiDB-Binlog 与 Reparo 原理简介与部署使用","description":"","frontmatter":{},"headers":[],"relativePath":"zh/work/tidb/TiDB-EcosystematicTools/5-6Binlog/01Binlog及Reparo原理与使用.md","filePath":"zh/work/tidb/TiDB-EcosystematicTools/5-6Binlog/01Binlog及Reparo原理与使用.md"}'),l={name:"zh/work/tidb/TiDB-EcosystematicTools/5-6Binlog/01Binlog及Reparo原理与使用.md"};function t(h,s,e,k,r,d){return n(),a("div",null,s[0]||(s[0]=[p(`<h1 id="tidb-binlog-与-reparo-原理简介与部署使用" tabindex="-1">TiDB-Binlog 与 Reparo 原理简介与部署使用 <a class="header-anchor" href="#tidb-binlog-与-reparo-原理简介与部署使用" aria-label="Permalink to &quot;TiDB-Binlog 与 Reparo 原理简介与部署使用&quot;">​</a></h1><blockquote><ul><li><a href="#Binlog原理简介">Binlog原理简介</a></li><li><a href="#下载部署">下载部署</a></li><li><a href="#配置pump与drainer">配置pump与drainer</a></li><li><a href="#Binlog启动与验证">Binlog启动与验证</a></li><li><a href="#checkpoint一致性检查">checkpoint一致性检查</a></li><li><a href="#Binlog-Relaylog启动与验证">Binlog-Relaylog启动与验证</a></li><li><a href="#BR配合TiDB-Binlog实现增量备份">BR配合TiDB-Binlog实现增量备份</a><ul><li><a href="#异常情况下修改Pump/Drainer状态">异常情况下修改Pump/Drainer状态</a></li></ul></li><li><a href="#binlogctl工具的下载与使用">binlogctl工具的下载与使用</a><ul><li><a href="#工具的下载部署">工具的下载部署</a></li><li><a href="#工具的使用">工具的使用</a></li></ul></li><li><a href="#BR配合TiDB-Binlog实现增量备份">BR配合TiDB-Binlog实现增量备份</a><ul><li><a href="#环境与数据准备">环境与数据准备</a></li><li><a href="#BR全量备份">BR全量备份</a></li><li><a href="#破坏性删库">破坏性删库</a></li><li><a href="#BR全量恢复">BR全量恢复</a></li><li><a href="#Reparo基于时间点增量恢复">Reparo基于时间点增量恢复</a></li><li><a href="#验证基于时间点恢复正确性">验证基于时间点恢复正确性</a></li></ul></li><li><a href="#参考文章">参考文章</a></li></ul></blockquote><h2 id="binlog原理简介" tabindex="-1">Binlog原理简介 <a class="header-anchor" href="#binlog原理简介" aria-label="Permalink to &quot;Binlog原理简介&quot;">​</a></h2><figure><img src="https://download.pingcap.com/images/docs-cn/tidb-binlog-cluster-architecture.png" alt="TiDB Binlog 整体架构" tabindex="0"><figcaption>TiDB Binlog 整体架构</figcaption></figure><ul><li><p>TiDB Binlog 支持以下功能场景</p><ul><li>数据同步：同步 TiDB 集群数据到其他数据库</li><li>实时备份和恢复：备份 TiDB 集群数据，同时可以用于 TiDB 集群故障时恢复</li></ul></li><li><p>Pump: 用于实时记录 TiDB 产生的 Binlog，并将 Binlog 按照事务的提交时间进行排序，再提供给 Drainer 进行消费</p></li><li><p>Drainer: 从各个 Pump 中收集 Binlog 进行归并，再将 Binlog 转化成 SQL 或者指定格式的数据，最终同步到下游</p></li></ul><h2 id="下载部署" tabindex="-1">下载部署 <a class="header-anchor" href="#下载部署" aria-label="Permalink to &quot;下载部署&quot;">​</a></h2><ul><li>pump与drainer</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[tidb@tiup-tidb41 binlogctl]$ tiup install 组件名称</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[tidb@tiup-tidb41 binlogctl]$ tiup list --installed</span></span>
<span class="line"><span>Available components:</span></span>
<span class="line"><span>Name            Owner    Description</span></span>
<span class="line"><span>----            -----    -----------</span></span>
<span class="line"><span>......</span></span>
<span class="line"><span>......</span></span>
<span class="line"><span>drainer         pingcap  The drainer componet of TiDB binlog service</span></span>
<span class="line"><span>pump            pingcap  The pump componet of TiDB binlog service</span></span>
<span class="line"><span>......</span></span>
<span class="line"><span>......</span></span></code></pre></div><ul><li>reparo <a href="https://download.pingcap.org/tidb-binlog-cluster-latest-linux-amd64.tar.gz" target="_blank" rel="noreferrer"><strong>下载链接</strong></a></li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span> wget https://download.pingcap.org/tidb-binlog-cluster-latest-linux-amd64.tar.gz</span></span></code></pre></div><h2 id="配置pump与drainer" tabindex="-1">配置pump与drainer <a class="header-anchor" href="#配置pump与drainer" aria-label="Permalink to &quot;配置pump与drainer&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> binglog-scale-out.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pump_servers:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> host:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.169.41</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ssh_port:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 22</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    port:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8250</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    deploy_dir:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/data/tidb-deploy/pump-8250&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    data_dir:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/data/tidb-data/pump-8250&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    log_dir:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/data/tidb-deploy/pump-8250/log&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    numa_node:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;0&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # The following configs are used to overwrite the \`server_configs.drainer\` values.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    config:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      gc:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 7</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> host:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.169.42</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ssh_port:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 22</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    port:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8250</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    deploy_dir:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/data/tidb-deploy/pump-8250&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    data_dir:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/data/tidb-data/pump-8250&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    log_dir:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/data/tidb-deploy/pump-8250/log&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    numa_node:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;0&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> host:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.169.43</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ssh_port:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 22</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    port:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8250</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    deploy_dir:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/data/tidb-deploy/pump-8250&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    data_dir:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/data/tidb-data/pump-8250&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    log_dir:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/data/tidb-deploy/pump-8250/log&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    numa_node:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;0&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drainer_servers:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> host:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.169.44</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    port:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8249</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    data_dir:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/data/tidb-data/drainer-8249&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # If drainer doesn&#39;t have a checkpoint, use initial commitTS as the initial checkpoint.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Will get a latest timestamp from pd if commit_ts is set to -1 (the default value).</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    commit_ts:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    deploy_dir:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/data/tidb-deploy/drainer-8249&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    log_dir:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/data/tidb-deploy/drainer-8249/log&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    numa_node:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;0&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#     # The following configs are used to overwrite the \`server_configs.drainer\` values.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    config:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      syncer.db-type:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;mysql&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      syncer.to.host:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;192.168.169.45&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      syncer.to.user:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;root&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      syncer.to.password:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;123123&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      syncer.to.port:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3306</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@tiup-tidb41 pump]$ tiup cluster scale-out tidb-test binglog-scale-out.yaml --wait-timeout 10000000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Starting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> component</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/tidb/.tiup/components/cluster/v1.3.1/tiup-cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scale-out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tidb-test</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> binglog-scale-out.yaml</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --wait-timeout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10000000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Please</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> confirm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> your</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> topology:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> type:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    tidb</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Serial</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UpdateTopology:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cluster=tidb-test</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Scaled</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tidb-test</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> successfully</span></span></code></pre></div><h2 id="binlog启动与验证" tabindex="-1">Binlog启动与验证 <a class="header-anchor" href="#binlog启动与验证" aria-label="Permalink to &quot;Binlog启动与验证&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MySQL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [(none)]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> show variables like </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;log_bin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+---------------+-------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Variable_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+---------------+-------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> log_bin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+---------------+-------+</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MySQL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [(none)]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> show pump status;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+---------------------+---------------------+--------+--------------------+---------------------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NodeID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">              |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> State</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Max_Commit_Ts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Update_Time</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+---------------------+---------------------+--------+--------------------+---------------------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 192.168.169.41:8250</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 192.168.169.41:8250</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> online</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 422310029132038145</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 2021-01-18</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10:48:33</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 192.168.169.42:8250</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 192.168.169.42:8250</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> online</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 422310029105561601</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 2021-01-18</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10:48:33</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 192.168.169.43:8250</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 192.168.169.43:8250</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> online</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 422310028725452801</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 2021-01-18</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10:48:33</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+---------------------+---------------------+--------+--------------------+---------------------+</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MySQL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [(none)]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> show drainer status;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+---------------------+---------------------+--------+--------------------+---------------------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NodeID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">              |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> State</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Max_Commit_Ts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Update_Time</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+---------------------+---------------------+--------+--------------------+---------------------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 192.168.169.44:8249</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 192.168.169.44:8249</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> online</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 422310030704640001</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 2021-01-18</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10:48:44</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+---------------------+---------------------+--------+--------------------+---------------------+</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@tiup-tidb41 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$ tiup cluster edit-config tidb-test</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">server_configs:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  tidb:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    binlog.enable:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    binlog.ignore-error:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@tiup-tidb41 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$ tiup cluster reload tidb-test -R tidb</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Starting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> component</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/tidb/.tiup/components/cluster/v1.3.1/tiup-cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reload</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tidb-test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tidb</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Reloaded</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tidb-test</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> successfully</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MySQL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [(none)]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> show variables like </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;log_bin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+---------------+-------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Variable_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+---------------+-------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> log_bin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+---------------+-------+</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MySQL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [(none)]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> show pump status;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+---------------------+---------------------+--------+--------------------+---------------------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NodeID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">              |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> State</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Max_Commit_Ts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Update_Time</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+---------------------+---------------------+--------+--------------------+---------------------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 192.168.169.41:8250</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 192.168.169.41:8250</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> online</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 422310865001250817</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 2021-01-18</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 11:41:42</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 192.168.169.42:8250</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 192.168.169.42:8250</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> online</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 422310864476962817</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 2021-01-18</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 11:41:42</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 192.168.169.43:8250</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 192.168.169.43:8250</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> online</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 422310864752214017</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 2021-01-18</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 11:41:42</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+---------------------+---------------------+--------+--------------------+---------------------+</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MySQL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [(none)]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> show drainer status;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+---------------------+---------------------+--------+--------------------+---------------------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NodeID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">              |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> State</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Max_Commit_Ts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Update_Time</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+---------------------+---------------------+--------+--------------------+---------------------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 192.168.169.44:8249</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 192.168.169.44:8249</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> online</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 422310865787682817</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 2021-01-18</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 11:41:48</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+---------------------+---------------------+--------+--------------------+---------------------+</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 上游 TiDB 端检查</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MySQL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [(none)]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> create database test 234;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MySQL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [(none)]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> show databases;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+--------------------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Database</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+--------------------+</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> test234</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            |</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+--------------------+</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MySQL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [test234]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> insert into t values(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&#39;t_1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MySQL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [test234]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> * from t;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+----+------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+----+------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> t_1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+----+------+</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 下游 MySQL 端检查</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysql</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">show</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> databases</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+--------------------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Database</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+--------------------+</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> test234</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            |</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+--------------------+</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysql</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">select</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test234.t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+----+------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+----+------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> t_1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+----+------+</span></span></code></pre></div><h2 id="checkpoint一致性检查" tabindex="-1">checkpoint一致性检查 <a class="header-anchor" href="#checkpoint一致性检查" aria-label="Permalink to &quot;checkpoint一致性检查&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>mysql&gt; select  * from tidb_binlog.checkpoint;</span></span>
<span class="line"><span>+---------------------+----------------------------------------------------------------+</span></span>
<span class="line"><span>| clusterID           | checkPoint                                                     |</span></span>
<span class="line"><span>+---------------------+----------------------------------------------------------------+</span></span>
<span class="line"><span>| 6915787285265719754 | {&quot;consistent&quot;:false,&quot;commitTS&quot;:422311266750300163,&quot;ts-map&quot;:{}} |</span></span>
<span class="line"><span>+---------------------+----------------------------------------------------------------+</span></span></code></pre></div><ul><li>tidb_binlog.checkpoint 的存储位置</li><li>tidb-binlog 的 pump，drianer 各个组件状态均为启动状态才会有 tidb_binlog.checkpoint</li><li>mysql/tidb 那么 tidb_binlog.checkpoint 表保存在被同步的目标下游 mysql/tidb 中</li><li>如果是 file 那么该信息保存在本地文件系统中</li></ul><h2 id="binlog-relaylog启动与验证" tabindex="-1">Binlog-Relaylog启动与验证 <a class="header-anchor" href="#binlog-relaylog启动与验证" aria-label="Permalink to &quot;Binlog-Relaylog启动与验证&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@tiup-tidb41 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$ tiup cluster edit-config tidb-test</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Starting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> component</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/tidb/.tiup/components/cluster/v1.3.1/tiup-cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> edit-config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tidb-test</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@tiup-tidb41 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$ tiup cluster edit-config tidb-test</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drainer_servers:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    syncer.relay.log-dir:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/tidb-data/drainer-8249/relay_log</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    syncer.relay.max-file-size:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10485760</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Please</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> check</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> change</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> highlight</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> above,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> do</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> you</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> want</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> change?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [y/N]: y</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Applying</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> changes...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Applied</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> successfully,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> please</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> use</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tiup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cluster reload tidb-test [-N </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nodes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">] [-R </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">roles</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reload</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config.</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Drainer 端验证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@tiup-tidb41 bin]$ tiup cluster reload tidb-test -R drainer</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Starting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> component</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/tidb/.tiup/components/cluster/v1.3.1/tiup-cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reload</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tidb-test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tidb</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Reloaded</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tidb-test</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> successfully</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@tiup-tidb44 relay_log]# pwd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/data/tidb-data/drainer-8249/relay_log</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@tiup-tidb44 relay_log]# ll</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">total</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-rw-------</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tidb</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tidb</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Jan</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 12:57</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> binlog-0000000000000000-20210118125724</span></span></code></pre></div><h4 id="异常情况下修改pump-drainer状态" tabindex="-1">异常情况下修改Pump/Drainer状态 <a class="header-anchor" href="#异常情况下修改pump-drainer状态" aria-label="Permalink to &quot;异常情况下修改Pump/Drainer状态&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>MySQL [test234]&gt; change pump to node_state =&#39;paused&#39; for node_id &#39;192.168.169.41:8250&#39;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>MySQL [test234]&gt; change pump to node_state =&#39;online&#39; for node_id &#39;192.168.169.41:8250&#39;;</span></span></code></pre></div><ul><li>Pump/Drainer 中状态的定义： <ul><li>online：正常运行中</li><li>pausing：暂停中</li><li>paused：已暂停</li><li>closing：下线中</li><li>offline：已下线</li></ul></li><li>注意：只有在异常状态下，该命令才有作用，因为当 Pump/Drainer 存在异常时，状态信息存在于 PD 中，该命令用于修改 PD 中信息。</li></ul><h2 id="binlogctl工具的下载与使用" tabindex="-1">binlogctl工具的下载与使用 <a class="header-anchor" href="#binlogctl工具的下载与使用" aria-label="Permalink to &quot;binlogctl工具的下载与使用&quot;">​</a></h2><h4 id="工具的下载部署" tabindex="-1">工具的下载部署 <a class="header-anchor" href="#工具的下载部署" aria-label="Permalink to &quot;工具的下载部署&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>wget https://download.pingcap.org/tidb-{version}-linux-amd64.tar.gz </span></span>
<span class="line"><span></span></span>
<span class="line"><span>wget https://download.pingcap.org/tidb-{version}-linux-amd64.sha256</span></span>
<span class="line"><span></span></span>
<span class="line"><span>sha256sum -c tidb-{version}-linux-amd64.sha256</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[tidb@tiup-tidb41 binlogctl]$ sha256sum -c tidb-v4.0.9-linux-amd64.sha256</span></span>
<span class="line"><span>tidb-v4.0.9-linux-amd64.tar.gz: OK</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[tidb@tiup-tidb41 binlogctl]$ tar -xvf tidb-v4.0.9-linux-amd64.tar.gz</span></span></code></pre></div><h4 id="工具的使用" tabindex="-1">工具的使用 <a class="header-anchor" href="#工具的使用" aria-label="Permalink to &quot;工具的使用&quot;">​</a></h4><ul><li>查询所有的 Pump/Drainer 的状态</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@tiup-tidb41 bin]$ ./binlogctl -pd-urls</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://192.168.169.41:2379</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> -cmd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pumps</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[2021/01/18 12:40:40.644 -05:00] [INFO] [nodes.go:53] [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;query node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] [type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pump] [node</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{NodeID: 192.168.169.43:8250, Addr: 192.168.169.43:8250, State: online, MaxCommitTS: 422311792296591361, UpdateTime: 2021-01-18 12:40:38 -0500 EST}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[2021/01/18 12:40:40.644 -05:00] [INFO] [nodes.go:53] [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;query node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] [type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pump] [node</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{NodeID: 192.168.169.41:8250, Addr: 192.168.169.41:8250, State: online, MaxCommitTS: 422311791614754817, UpdateTime: 2021-01-18 12:40:38 -0500 EST}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[2021/01/18 12:40:40.645 -05:00] [INFO] [nodes.go:53] [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;query node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] [type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pump] [node</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{NodeID: 192.168.169.42:8250, Addr: 192.168.169.42:8250, State: online, MaxCommitTS: 422311791929851907, UpdateTime: 2021-01-18 12:40:38 -0500 EST}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@tiup-tidb41 bin]$ ./binlogctl -pd-urls</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://192.168.169.41:2379</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> -cmd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> drainers</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[2021/01/18 12:41:07.968 -05:00] [INFO] [nodes.go:53] [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;query node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] [type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">drainer] [node</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{NodeID: 192.168.169.44:8249, Addr: 192.168.169.44:8249, State: online, MaxCommitTS: 422311798693167108, UpdateTime: 2021-01-18 12:41:06 -0500 EST}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><ul><li>暂停/下线 Pump/Drainer</li></ul><table tabindex="0"><thead><tr><th>命令</th><th>涵义</th><th>范例</th></tr></thead><tbody><tr><td>pause-pump</td><td>暂停</td><td>Pump bin/binlogctl -pd-urls=<a href="http://127.0.0.1:2379" target="_blank" rel="noreferrer">http://127.0.0.1:2379</a> -cmd pause-pump -node-id ip-127-0-0-1:8250</td></tr><tr><td>pause-drainer</td><td>暂停</td><td>Drainer bin/binlogctl -pd-urls=<a href="http://127.0.0.1:2379" target="_blank" rel="noreferrer">http://127.0.0.1:2379</a> -cmd pause-drainer -node-id ip-127-0-0-1:8249</td></tr><tr><td>offline-pump</td><td>下线</td><td>Pump bin/binlogctl -pd-urls=<a href="http://127.0.0.1:2379" target="_blank" rel="noreferrer">http://127.0.0.1:2379</a> -cmd offline-pump -node-id ip-127-0-0-1:8250</td></tr><tr><td>offline-drainer</td><td>下线</td><td>Drainer bin/binlogctl -pd-urls=<a href="http://127.0.0.1:2379" target="_blank" rel="noreferrer">http://127.0.0.1:2379</a> -cmd offline-drainer -node-id ip-127-0-0-1:8249</td></tr></tbody></table><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[tidb@tiup-tidb41 bin]$ binlogctl -pd-urls=http://127.0.0.1:2379 -cmd pause-pump -node-id 192.168.169.41:8250</span></span>
<span class="line"><span>[2021/01/18 12:44:33.347 -05:00] [INFO] [nodes.go:123] [&quot;Apply action on node success&quot;] [action=pause] [NodeID=192.168.169.41:8250]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[tidb@tiup-tidb41 bin]$ ./binlogctl -pd-urls=http://192.168.169.41:2379 -cmd pumps </span></span>
<span class="line"><span>[2021/01/18 12:44:39.997 -05:00] [INFO] [nodes.go:53] [&quot;query node&quot;] [type=pump] [node=&quot;{NodeID: 192.168.169.41:8250, Addr: 192.168.169.41:8250, State: paused, MaxCommitTS: 422311853021986817, UpdateTime: 2021-01-18 12:44:32 -0500 EST}&quot;]</span></span>
<span class="line"><span>......</span></span>
<span class="line"><span>......</span></span>
<span class="line"><span></span></span>
<span class="line"><span>MySQL [test234]&gt; show pump status;</span></span>
<span class="line"><span>+---------------------+---------------------+--------+--------------------+---------------------+</span></span>
<span class="line"><span>| NodeID              | Address             | State  | Max_Commit_Ts      | Update_Time         |</span></span>
<span class="line"><span>+---------------------+---------------------+--------+--------------------+---------------------+</span></span>
<span class="line"><span>| 192.168.169.41:8250 | 192.168.169.41:8250 | paused | 422311853021986817 | 2021-01-18 12:44:32 |</span></span>
<span class="line"><span>| 192.168.169.42:8250 | 192.168.169.42:8250 | online | 422311857281826817 | 2021-01-18 12:44:48 |</span></span>
<span class="line"><span>| 192.168.169.43:8250 | 192.168.169.43:8250 | online | 422311856862658561 | 2021-01-18 12:44:48 |</span></span>
<span class="line"><span>+---------------------+---------------------+--------+--------------------+---------------------+</span></span></code></pre></div><p>其他命令同理;</p><ul><li>异常情况下修改 Pump/Drainer 的状态</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@tiup-tidb41 bin]$ ./binlogctl -pd-urls</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://192.168.169.41:2379</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> -cmd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update-pump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -node-id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 192.168.169.41:8250</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -state</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> online</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@tiup-tidb41 bin]$ ./binlogctl -pd-urls</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://192.168.169.41:2379</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> -cmd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pumps</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[2021/01/18 12:48:42.249 -05:00] [INFO] [nodes.go:53] [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;query node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] [type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pump] [node</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{NodeID: 192.168.169.41:8250, Addr: 192.168.169.41:8250, State: online, MaxCommitTS: 422311853021986817, UpdateTime: 2021-01-18 12:44:32 -0500 EST}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><h2 id="br配合tidb-binlog实现增量备份" tabindex="-1">BR配合TiDB-Binlog实现增量备份 <a class="header-anchor" href="#br配合tidb-binlog实现增量备份" aria-label="Permalink to &quot;BR配合TiDB-Binlog实现增量备份&quot;">​</a></h2><h4 id="环境与数据准备" tabindex="-1">环境与数据准备 <a class="header-anchor" href="#环境与数据准备" aria-label="Permalink to &quot;环境与数据准备&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[tidb@tiup-tidb41 reparo]$ cp ~/binlogctl/tidb-v4.0.9-linux-amd64/bin/reparo ./</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[tidb@tiup-tidb41 reparo]$ ll</span></span>
<span class="line"><span>total 51180</span></span>
<span class="line"><span>-rwxr-xr-x 1 tidb tidb 52407079 Jan 18 13:06 reparo</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>MySQL [(none)]&gt; create database full_backup_point_recover_1;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>MySQL [(none)]&gt; create database full_backup_point_recover_2;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>MySQL [(none)]&gt; use full_backup_point_recover_1;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>MySQL [full_backup_point_recover_1]&gt; create table jan_test_1(id int auto_increment primary key, name varchar(20));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>MySQL [full_backup_point_recover_1]&gt; use full_backup_point_recover_2;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>MySQL [full_backup_point_recover_2]&gt; create table jan_test_2(id int auto_increment primary key, name varchar(20));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>MySQL [full_backup_point_recover_2]&gt; insert into full_backup_point_recover_1.jan_test_1(name) values (&#39;jan_test_1&#39;),(&#39;jan_test_2&#39;),(&#39;jan_test_3&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>MySQL [full_backup_point_recover_2]&gt; insert into full_backup_point_recover_2.jan_test_2(name) values (&#39;jan_test_1&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>MySQL [full_backup_point_recover_2]&gt; select * from full_backup_point_recover_1.jan_test_1;</span></span>
<span class="line"><span>+----+------------+</span></span>
<span class="line"><span>| id | name       |</span></span>
<span class="line"><span>+----+------------+</span></span>
<span class="line"><span>|  1 | jan_test_1 |</span></span>
<span class="line"><span>|  2 | jan_test_2 |</span></span>
<span class="line"><span>|  3 | jan_test_3 |</span></span>
<span class="line"><span>+----+------------+</span></span>
<span class="line"><span></span></span>
<span class="line"><span>MySQL [full_backup_point_recover_2]&gt; select * from full_backup_point_recover_2.jan_test_2;</span></span>
<span class="line"><span>+----+------------+</span></span>
<span class="line"><span>| id | name       |</span></span>
<span class="line"><span>+----+------------+</span></span>
<span class="line"><span>|  1 | jan_test_1 |</span></span>
<span class="line"><span>+----+------------+</span></span>
<span class="line"><span></span></span>
<span class="line"><span>MySQL [full_backup_point_recover_2]&gt; select now();</span></span>
<span class="line"><span>+---------------------+</span></span>
<span class="line"><span>| now()               |</span></span>
<span class="line"><span>+---------------------+</span></span>
<span class="line"><span>| 2021-01-18 13:32:26 |</span></span>
<span class="line"><span>+---------------------+</span></span></code></pre></div><h4 id="br全量备份" tabindex="-1">BR全量备份 <a class="header-anchor" href="#br全量备份" aria-label="Permalink to &quot;BR全量备份&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[tidb@tiup-tidb41 ~]$ tiup br backup full --pd 192.168.169.42:2379 --storage &quot;local:///home/tidb/reparo/full_backup&quot; --ratelimit 120 --log-file /home/tidb/reparo/full_backup/log/full_backup_20200119.log</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Starting component \`br\`: /home/tidb/.tiup/components/br/v4.0.9/br backup full --pd 192.168.169.42:2379 --storage local:///home/tidb/reparo/full_backup --ratelimit 120 --log-file /home/tidb/reparo/full_backup/log/full_backup_20200119.log</span></span>
<span class="line"><span>Detail BR log in /home/tidb/reparo/full_backup/log/full_backup_20200119.log </span></span>
<span class="line"><span>Full backup &lt;---------------------------------------------------------------------------------------------------------------------------------------&gt; 100.00%</span></span>
<span class="line"><span>Checksum &lt;------------------------------------------------------------------------------------------------------------------------------------------&gt; 100.00%</span></span>
<span class="line"><span>[2021/01/18 13:39:52.129 -05:00] [INFO] [collector.go:60] [&quot;Full backup Success summary: total backup ranges: 28, total success: 28, total failed: 0, total take(Full backup time): 11.599128783s, total take(real time): 15.218534235s, total kv: 841399, total size(MB): 173.31, avg speed(MB/s): 14.94&quot;] [&quot;backup fast checksum&quot;=40.578617ms] [&quot;backup checksum&quot;=563.344738ms] [&quot;backup total regions&quot;=28] [BackupTS=422312719696527362] [Size=83443904]</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>MySQL [(none)]&gt; select now();</span></span>
<span class="line"><span>+---------------------+</span></span>
<span class="line"><span>| now()               |</span></span>
<span class="line"><span>+---------------------+</span></span>
<span class="line"><span>| 2021-01-18 13:40:20 |</span></span>
<span class="line"><span>+---------------------+</span></span></code></pre></div><h3 id="破坏性删库" tabindex="-1">破坏性删库 <a class="header-anchor" href="#破坏性删库" aria-label="Permalink to &quot;破坏性删库&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>MySQL [full_backup_point_recover_2]&gt; delete from full_backup_point_recover_1.jan_test_1 where id = 1;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>MySQL [(none)]&gt; select now();</span></span>
<span class="line"><span>+---------------------+</span></span>
<span class="line"><span>| now()               |</span></span>
<span class="line"><span>+---------------------+</span></span>
<span class="line"><span>| 2021-01-18 13:40:42 |</span></span>
<span class="line"><span>+---------------------+</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>MySQL [(none)]&gt; select * from full_backup_point_recover_1.jan_test_1;</span></span>
<span class="line"><span>+----+------------+</span></span>
<span class="line"><span>| id | name       |</span></span>
<span class="line"><span>+----+------------+</span></span>
<span class="line"><span>|  2 | jan_test_2 |</span></span>
<span class="line"><span>|  3 | jan_test_3 |</span></span>
<span class="line"><span>+----+------------+</span></span>
<span class="line"><span></span></span>
<span class="line"><span>MySQL [(none)]&gt; drop database full_backup_point_recover_1;</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>MySQL [(none)]&gt; drop database full_backup_point_recover_2;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>MySQL [(none)]&gt; select now();</span></span>
<span class="line"><span>+---------------------+</span></span>
<span class="line"><span>| now()               |</span></span>
<span class="line"><span>+---------------------+</span></span>
<span class="line"><span>| 2021-01-18 13:50:21 |</span></span>
<span class="line"><span>+---------------------+</span></span></code></pre></div><h4 id="br全量恢复" tabindex="-1">BR全量恢复 <a class="header-anchor" href="#br全量恢复" aria-label="Permalink to &quot;BR全量恢复&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[tidb@tiup-tidb41 full_backup]$ tiup br restore full  --storage &quot;local:///home/tidb/reparo/full_backup&quot; --ratelimit 128 --log-file /home/tidb/reparo/full_backup/log/full_restore_20200119.log</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Starting component \`br\`: /home/tidb/.tiup/components/br/v4.0.9/br restore full --storage local:///home/tidb/reparo/full_backup --ratelimit 128 --log-file /home/tidb/reparo/full_backup/log/full_restore_20200119.log</span></span>
<span class="line"><span>Detail BR log in /home/tidb/reparo/full_backup/log/full_restore_20200119.log </span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>Full restore &lt;-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&gt; 100.00%</span></span>
<span class="line"><span>[2021/01/18 14:36:46.599 -05:00] [INFO] [collector.go:60] [&quot;Full restore Success summary: total restore files: 23, total success: 23, total failed: 0, total take(Full restore time): 40m38.372489542s, total take(real time): 42m7.069324518s, total kv: 841399, total size(MB): 173.31, avg speed(MB/s): 0.07&quot;] [&quot;restore checksum&quot;=40m33.969324142s] [&quot;split region&quot;=2.778469128s] [&quot;restore ranges&quot;=21] [Size=83443904]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>MySQL [full_backup_point_recover_1]&gt; select * from full_backup_point_recover_1.jan_test_1;</span></span>
<span class="line"><span>+----+------------+</span></span>
<span class="line"><span>| id | name       |</span></span>
<span class="line"><span>+----+------------+</span></span>
<span class="line"><span>|  1 | jan_test_1 |</span></span>
<span class="line"><span>|  2 | jan_test_2 |</span></span>
<span class="line"><span>|  3 | jan_test_3 |</span></span>
<span class="line"><span>+----+------------+</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>MySQL [full_backup_point_recover_1]&gt; select * from full_backup_point_recover_2.jan_test_2;</span></span>
<span class="line"><span>+----+------------+</span></span>
<span class="line"><span>| id | name       |</span></span>
<span class="line"><span>+----+------------+</span></span>
<span class="line"><span>|  1 | jan_test_1 |</span></span>
<span class="line"><span>+----+------------+</span></span></code></pre></div><h4 id="reparo基于时间点增量恢复" tabindex="-1">Reparo基于时间点增量恢复 <a class="header-anchor" href="#reparo基于时间点增量恢复" aria-label="Permalink to &quot;Reparo基于时间点增量恢复&quot;">​</a></h4><p>增量部分从 2021-01-18 13:32:26 开始恢复，恢复至 2021-01-18 13:40:42 时间点;</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reparo.toml</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Drainer 输出的 protobuf 格式 binlog 文件的存储路径。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">data-dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/data/tidb-data/drainer-8249/relay_log&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 日志输出信息等级设置：debug, info, warn, error, fatal (默认值：info)。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log-level</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;info&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用 start-datetime 和 stop-datetime 来选择恢复指定时间范围内的 binlog，格式为 “2006-01-02 15:04:05”。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">start-datetime</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;2021-01-18 13:32:26&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stop-datetime</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;2021-01-18 13:40:42&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 下游服务类型。 取值为 print, mysql（默认值：print）。当值为 print 时，只做解析打印到标准输出，不执行 SQL；  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果为 mysql，则需要在 [dest-db] 中配置 host、port、user、password 等信息。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dest-type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;mysql&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输出到下游数据库一个事务的 SQL 语句数量（默认 20）。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">txn-batch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 同步下游的并发数，该值设置越高同步的吞吐性能越好（默认 16）。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">worker-count</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 16</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安全模式配置。取值为 true 或 false（默认值：false）。当值为 true 时，Reparo 会将 update 语句拆分为 delete + replace 语句。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">safe-mode</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># replicate-do-db 和 replicate-do-table 用于指定恢复的库和表，replicate-do-db 的优先级高于 replicate-do-table。支持使用正则表达式来配置，需要以 &#39;~&#39; 开始声明使用正则表达式。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 注：replicate-do-db 和 replicate-do-table 使用方式与 Drainer 的使用方式一致。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># replicate-do-db = [&quot;~^b.*&quot;,&quot;s1&quot;]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [[replicate-do-table]]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># db-name =&quot;test&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># tbl-name = &quot;log&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [[replicate-do-table]]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># db-name =&quot;test&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># tbl-name = &quot;~^a.*&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果 dest-type 设置为 mysql, 需要配置 dest-db</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[dest-db]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">host</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;192.168.169.41&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">port</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;root&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">password</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span></span></code></pre></div><h4 id="验证基于时间点恢复正确性" tabindex="-1">验证基于时间点恢复正确性 <a class="header-anchor" href="#验证基于时间点恢复正确性" aria-label="Permalink to &quot;验证基于时间点恢复正确性&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>select * from full_backup_point_recover_1.jan_test_1;</span></span>
<span class="line"><span>select * from full_backup_point_recover_2.jan_test_2;</span></span></code></pre></div><h2 id="参考文章" tabindex="-1">参考文章 <a class="header-anchor" href="#参考文章" aria-label="Permalink to &quot;参考文章&quot;">​</a></h2><p><a href="https://docs.pingcap.com/zh/tidb/stable/deploy-tidb-binlog#tidb-binlog-%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2" target="_blank" rel="noreferrer">PingCap-Binlog 集群部署:https://docs.pingcap.com/zh/tidb/stable/deploy-tidb-binlog#tidb-binlog-%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2</a></p><p><a href="https://asktug.com/t/topic/33884" target="_blank" rel="noreferrer">TiIP 扩展方式集成 Pump、Drainer : https://asktug.com/t/topic/33884</a></p><p><a href="https://asktug.com/t/topic/37569" target="_blank" rel="noreferrer">AskTUG-部署Drainer出现异常错误:https://asktug.com/t/topic/37569</a></p><p><a href="https://asktug.com/t/topic/33675" target="_blank" rel="noreferrer">AskTUG-tidb_binlog.checkpoint表不存在:https://asktug.com/t/topic/33675</a></p>`,53)]))}const o=i(l,[["render",t]]);export{g as __pageData,o as default};
