
## 项目背景
UAS系统，全称承保辅助决策系统，是原先运行在MyCat上的，具有OLAP为主、OLTP为辅的业务类型属性。原有MyCat曾出现因运行OLAP SQL 影响OLTP SQL正常运行现象。经使用测试发现，TiDB在UAS系统中能将原运行2小时SQL在20分钟跑出结果，因此UAS决定将系统迁移至 TiDB。


## 项目进度
	TiDB，上线使用版本为v4.0.13，推荐使用 SSD磁盘，但甲方资源紧张，甲方要求在非SSD磁盘测试是否符合业务要求。目前UAS有两套测试环境，SSD磁盘集群及非SSD测试集群。
SSD集群基本适配完毕，并已基本完成迁移方案。目前，采用shell脚本封装mysqldump工具分5批迁移上线。因为客户要求分批分机构上线，目前TiDB没有工具能满足此项要求，所以利用where条件过滤出mycat中表的分片字段对应的数据转换成SQL进行迁移。脚本在SSD磁盘上实测，8千万数据耗时5.6小时，基本满足停机窗口要求。
非SSD集群上正在测试中，随着磁盘性能的降低暴露出诸多问题，具体参考“ 2.5 非SSD集群问题“内容。脚本在非SSD磁盘上实测，8千万数据耗时32小时，不满足停机窗口要求，暂无解决方案。



## 2.4 SSD集群问题
2.4.1  mycat分片表迁至TiDB一张表，分片主键报主键冲突
                        解决方式：在TiDB建表之初，取消原ID列auto_increment属性，增加自增TiDB_ID列，待所有数据迁移完毕后，将ID列drop掉并改名TiDB_ID为ID。

2.5 非SSD集群问题
	2.5.1 脚本迁移生产数据过慢，无法满足停机窗口，暂无解决方式；
2.5.2 Affect Rows不准确，TiDB 产品问题，暂无解决方式；
2.5.3 统计信息在导完数之后，不会触发自动收集统计信息，需手动收集；
	2.5.4 其余问题记录在“问题记录.doc”中。
