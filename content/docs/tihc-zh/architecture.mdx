---
title: Architecture
description: 扩展 UI、serverless 后端、GraphRAG、评估之间的关系
---

## Components

- **Extension UI (`tihc`)**
  - 负责交互、展示流式输出
  - 支持 Google 登录（获取 token）
  - 将请求转发到 serverless（默认），本地 WebLLM 作为 fallback

- **Serverless (`tihc-serverless`)**
  - 单入口 API：`POST /api/stream_chat`
  - 基于 `chat_engine` 选择：
    - `openai`：OpenAI streaming → 纯文本流
    - `openai_rag`：GraphRAG 取上下文 → OpenAI 回答
    - `manus`：代理到 Manus API
    - `tidb`：代理到 TiDB doc GraphRAG 上游
  - Google tokeninfo 校验 + Workspace 域名限制（`GOOGLE_WORKSPACE_DOMAIN`）

- **Evaluation (`evalite-demo`)**
  - gold 集：监督评估“问题空间收敛”
  - traces：真实数据的统计分析（可无标注）

## Data & Privacy

默认不落库：serverless 只做“请求→工具/模型→流式返回”。

如果要做访问控制/审计/评估收集，建议只存：

- user 标识（hash）、时间戳、engine、token 数、latency
- 不存原始问题文本/对话（或先脱敏）

