const u=(i,o)=>{i.attrs=i.attrs?.filter(([r])=>r!==o)??null},d=i=>{const o=i.attrs?.find(([r])=>r==="title")?.[1];return o?(u(i,"title"),o):i.content},k=(i,o={})=>{const r=e=>{for(let t=1,{length:l}=e.tokens;t<l-1;t++){const n=e.tokens[t];if(n.type!=="inline"||!n.children||n.children.length!==1&&n.children.length!==3||n.children.length===1&&n.children[0].type!=="image")continue;if(n.children.length===3){const[g,a,f]=n.children;if(g.type!=="link_open"||a.type!=="image"||f.type!=="link_close")continue}if(t!==0&&e.tokens[t-1].type!=="paragraph_open"||t!==l-1&&e.tokens[t+1].type!=="paragraph_close")continue;const c=e.tokens[t-1];c.type="figure_open",c.tag="figure",e.tokens[t+1].type="figure_close",e.tokens[t+1].tag="figure";const s=n.children.length===1?n.children[0]:n.children[1],h=d(s),[p]=i.parseInline(h,e.env);n.children.push(new e.Token("figcaption_open","figcaption",1)),n.children.push(...p.children??[]),n.children.push(new e.Token("figcaption_close","figcaption",-1)),o.focusable!==!1&&s.attrPush(["tabindex","0"])}};i.core.ruler.before("linkify","figure",r)};export{k as figure};
//# sourceMappingURL=index.js.map
