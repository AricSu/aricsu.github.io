import{_ as i,a,b as t,c as h,d as k}from"./chunks/06streams-and-tables-.CrCFBVZS.js";import{_ as n,c as l,a5 as p,o as e}from"./chunks/framework.PytyN_aB.js";const c=JSON.parse('{"title":"使用背景","description":"","frontmatter":{},"headers":[],"relativePath":"en/tidb/05TiDB-EcosystematicTools/5-1TiCDC/01TiCDC Overview.md","filePath":"en/tidb/05TiDB-EcosystematicTools/5-1TiCDC/01TiCDC Overview.md"}'),F={name:"en/tidb/05TiDB-EcosystematicTools/5-1TiCDC/01TiCDC Overview.md"};function r(d,s,g,C,o,y){return e(),l("div",null,s[0]||(s[0]=[p('<h1 id="使用背景" tabindex="-1">使用背景 <a class="header-anchor" href="#使用背景" aria-label="Permalink to &quot;使用背景&quot;">​</a></h1><h2 id="一、项目背景" tabindex="-1">一、项目背景 <a class="header-anchor" href="#一、项目背景" aria-label="Permalink to &quot;一、项目背景&quot;">​</a></h2><p>        如 <a href="https://docs.pingcap.com/zh/tidb/stable/ticdc-overview" target="_blank" rel="noreferrer">PingCAP 官网</a> 所述，TiCDC 的使用场景主要有 <strong>“数据库灾备”</strong> 及 <strong>“数据集成”</strong>。熟悉 TiDB 周边生态的爱好者一定知道 <strong>“TiDB Binlog”</strong> 这一与 TiCDC 功能相似的工具，<strong>那么为什么要重复工作呢？</strong><br>          答案是 “TiDB Binlog” 无法存在以下(非全部)种种问题，对于 “TiDB Binlog” 还不熟悉的伙伴参考 <a href="https://docs.pingcap.com/zh/tidb/stable/tidb-binlog-overview" target="_blank" rel="noreferrer">TiDB Binlog 简介</a>：<br>          1. “TiDB Binlog” 扩展性差，如：Drainer 存在 “单点” 及 “性能” 问题，拆分 Drainer 无法保证 “数据行变更有序性”；<br>          2. “TiDB Binlog” 性能低下，如：“TiDB Binlog” 仅支持单 kafka 单 partition 写入，无法提高 kafka 吞吐量；<br>          3. “TiDB Binlog” 通用型差，如：写成 binlog 写成文件需要使用 Reparo 解析 SQL 语句，不支持 Maxwell、Canal 等通用协议；<br>          4. “TiDB Binlog” 同步痛点，如：binlog 写到下游受 GRPC max message 限制多，如 <a href="https://docs.pingcap.com/zh/tidb/stable/handle-tidb-binlog-errors#%E5%BD%93%E4%B8%8A%E6%B8%B8%E4%BA%8B%E5%8A%A1%E8%BE%83%E5%A4%A7%E6%97%B6pump-%E6%8A%A5%E9%94%99-rpc-error-code--resourceexhausted-desc--trying-to-send-message-larger-than-max-2191430008-vs-2147483647" target="_blank" rel="noreferrer">Pump 的 gRPC message 超过限值</a> 等等；<br>          5. “TiDB Binlog” 可用性差，如：单点的 Drainer 一旦出现问题同步将中断，不存在一定程度的自愈功能；</p><p>         由此 TiCDC 应运而生，通过直接捕获 TiKV Change Log ，将表作为拆分单元调度至各 Capture 中，并发向下游同步数据解决扩展性问题。可 kafka 多 partition 写入，并支持 Maxwell、Canal 等多种通用协议，解决同步性能、生态通用性问题。当同步超时、 Capture 同步表数量不均、Capture 挂掉等情况时，TiCDC 存在调度机制及 At Least Once 保证数据完整性前提下，调度实现自愈合。</p><figure><img src="'+i+'" alt="01BinlogAndTiCDC" tabindex="0"><figcaption>01BinlogAndTiCDC</figcaption></figure><h2 id="二、工具位置" tabindex="-1">二、工具位置 <a class="header-anchor" href="#二、工具位置" aria-label="Permalink to &quot;二、工具位置&quot;">​</a></h2><p>        首先，熟知 TiCDC 使用方法，必先明确其在 TiDB 生态工具所处的位置及作用。<br>          <strong>1. 作用而言</strong>：数据库如果是个只进不出的 <strong>“貔貅”</strong>，那么必将被市场所抛弃，也就是所谓的 <strong>“数据孤岛”</strong>，TiCDC 兼顾同步性能、数据完整性，一致性、生态通用性，实现了数据从 <strong>&quot;流入-&gt; TiDB -&gt;流出&quot;</strong> 的闭环。此外，谈性能如果抛弃了场景（不深入讨论），那就是在耍流氓，没有任何一个款产品能完胜所有场景，TiDB 同样也有自己的舒适区、痛点区。<strong>有了 TiCDC 之后，用户可以轻松实现数据的流转，把 TiDB 用在使用场景的舒适区。</strong><br>          <strong>2. 位置而言</strong>：TiCDC 介于 TiDB 与下游目的端之间，下游包含兼用 MySQL 通许协议的所有产品、平台（如：TiDB、MySQL、RDS、三方云平台等）。用户还可基于通用消息队列输出协议自定义开发，现 TiCDC 支持的协议有：Open Protocol 、Canal-JSON 、 Canal 、Avro 、 Maxwell 等协议，有些协议仅部分支持，详情参考 --&gt; <a href="https://github.com/pingcap/tiflow/blob/master/docs/design/2020-11-04-ticdc-protocol-list.md#protocols-%E5%88%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D" target="_blank" rel="noreferrer">TiCDC 支持的协议指南</a><br>          其次，TiCDC 几乎囊括所有主流 “数据同步” 的使用场景，下图便是 “MySQL --&gt; TiDB --&gt; Others” 的经典组合拳。至于其他协议的数据库（Oracle、PG）如何流入 TiDB，等同于如何流入 MySQL，因为 TiDB 兼容 MySQL 通讯协议，一定存在较成熟的解决方案。</p><figure><img src="'+a+'" alt="02UpstreamAndDownstream" tabindex="0"><figcaption>02UpstreamAndDownstream</figcaption></figure><h2 id="三、使用情况" tabindex="-1">三、使用情况 <a class="header-anchor" href="#三、使用情况" aria-label="Permalink to &quot;三、使用情况&quot;">​</a></h2><p>        <strong>注意：下述公司均通过 AskTUG 搜索相关文章得到，即：分享文章中有提及该公司正在使用 TICDC。下述公司仅是通过搜索手段可得知的公司，还有许多商业客户要求不对外透露、或还未来得及透露。</strong></p><h3 id="_3-1-小红书" tabindex="-1"><strong>3.1 小红书</strong> <a class="header-anchor" href="#_3-1-小红书" aria-label="Permalink to &quot;**3.1 小红书**&quot;">​</a></h3><p>        从 <code>张亿皓老师</code> 在 <a href="https://www.bilibili.com/video/BV1bD4y1o7qU?spm_id_from=333.337.search-card.all.click" target="_blank" rel="noreferrer">【PingCAP Infra Meetup】No.131 TiCDC 的生态和社区建设</a> 中分享可知，小红书基于 TiCDC 在业务中进行内容审核、笔记标签推荐、增长审计。实现如下图，基于 &quot;TiDB --&gt; TiCDC --&gt; Kafka --&gt; Flink --&gt; TiDB&quot; 这样一条链路实现与架构中其他数据源的聚合计算。</p><figure><img src="'+t+'" alt="03xiaohongshu_share" tabindex="0"><figcaption>03xiaohongshu_share</figcaption></figure><h3 id="_3-2-海尔智家" tabindex="-1"><strong>3.2 海尔智家</strong> <a class="header-anchor" href="#_3-2-海尔智家" aria-label="Permalink to &quot;**3.2 海尔智家**&quot;">​</a></h3><p>        从 <code>姚翔老师</code> 在 <a href="https://www.bilibili.com/video/BV1bD4y1o7qU?spm_id_from=333.337.search-card.all.click" target="_blank" rel="noreferrer">【PingCAP Infra Meetup】No.131 TiCDC 的生态和社区建设</a> 中分享可知，海尔智家基于 TICDC 在业务中进行搜索、推荐。将用户数据、生活家信息数据基于 &quot;TiDB --&gt; TiCDC --&gt; Kafka --&gt; ES&quot; 这样一条链路实现 Kafka 日消费量在 300 万左右的近实时搜索功能。从描述中可知截止 2019-09-19 分享时，<strong>TiCDC 在不涉及表数量、LOB 字段、网络延时等细节情况下，同步能力边界为：正常同步在 “毫秒” 级，抖动情况下在 “秒级”（10s 以内）。</strong><br>         此外，从 <a href="https://github.com/pingcap/tiflow/projects/13" target="_blank" rel="noreferrer">Github -- Question and Bug Reports</a> 中可以看出 TiCDC 存在 <code>mqSink flushes data synchronously,casing low performance</code>、<code>Poor incremental scan performance where they are frequent insertions</code>、<code>improve performance of syncer</code> 等多个提升同步性能的 RoadMap，对于 TiCDC 的同步性能是一个持续优化的过程。</p><figure><img src="'+h+`" alt="04haierzhijia_share" tabindex="0"><figcaption>04haierzhijia_share</figcaption></figure><h3 id="_3-3-360" tabindex="-1"><strong>3.3 360</strong> <a class="header-anchor" href="#_3-3-360" aria-label="Permalink to &quot;**3.3 360**&quot;">​</a></h3><p>        从 <code>代晓磊老师</code> 在 <a href="https://tidb.net/blog/2fa9cf6a" target="_blank" rel="noreferrer">BLOG - TiCDC 应用场景解析</a> 中分享可知，360 基于 TiCDC 实现并参与立项 <strong>增量数据抽取、同城双集群热备、流处理求</strong> 的需求。</p><h2 id="四、使用方法" tabindex="-1">四、使用方法 <a class="header-anchor" href="#四、使用方法" aria-label="Permalink to &quot;四、使用方法&quot;">​</a></h2><h3 id="_4-1-部署-ticdc" tabindex="-1">4.1 部署 TiCDC <a class="header-anchor" href="#_4-1-部署-ticdc" aria-label="Permalink to &quot;4.1 部署 TiCDC&quot;">​</a></h3><p>        下述测试环境搭建 TiCDC ，目的测试、学习 TiCDC 同步功能。<code>172.16.6.155:8300</code> 及 <code>172.16.6.196:8300</code> 的 CDC 组件会在扩容后出现。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@Linux-Hostname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$ tiup cluster display tidb-test</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                  Role</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          Host</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          Ports</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        OS/Arch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       Status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                     Deploy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Dir</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                  ----</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          ----</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          -----</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        -------</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       ------</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --------</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                                     ----------</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">172.16.6.155:9093</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   alertmanager</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  172.16.6.155</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  9093/9094</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    linux/x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      /home/data/tidb-home/data/alertmanager-9093</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /home/data/tidb-deploy/alertmanager-9093</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">172.16.6.155:8300</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   cdc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">           172.16.6.155</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  8300</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         linux/x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      /data/deploy/install/data/cdc-8300</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           /home/data/tidb-deploy/cdc-8300</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">172.16.6.196:8300</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   cdc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">           172.16.6.196</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  8300</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         linux/x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      /data/deploy/install/data/cdc-8300</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           /home/data/tidb-deploy/cdc-8300</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">172.16.6.155:3000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   grafana</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       172.16.6.155</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  3000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         linux/x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                            /home/data/tidb-deploy/grafana-3000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">172.16.6.155:2379</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   pd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            172.16.6.155</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  2379/2380</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    linux/x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Up</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UI</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   /home/data/tidb-home/data/pd-2379</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            /home/data/tidb-deploy/pd-2379</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">172.16.6.194:2379</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   pd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            172.16.6.194</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  2379/2380</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    linux/x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      /home/data/tidb-home/data/pd-2379</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            /home/data/tidb-deploy/pd-2379</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">172.16.6.196:2379</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   pd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            172.16.6.196</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  2379/2380</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    linux/x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Up</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">L</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    /home/data/tidb-home/data/pd-2379</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            /home/data/tidb-deploy/pd-2379</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">172.16.6.155:9090</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   prometheus</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    172.16.6.155</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  9090/12020</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   linux/x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      /home/data/tidb-home/data/prometheus-9090</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    /home/data/tidb-deploy/prometheus-9090</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">172.16.6.155:4000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   tidb</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          172.16.6.155</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  4000/10080</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   linux/x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                            /home/data/tidb-deploy/tidb-4000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">172.16.6.196:4000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   tidb</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          172.16.6.196</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  4000/10080</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   linux/x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                            /home/data/tidb-deploy/tidb-4000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">172.16.6.155:20160</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  tikv</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          172.16.6.155</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  20160/20180</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  linux/x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      /home/data/tidb-home/data/tikv-20160</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         /home/data/tidb-deploy/tikv-20160</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">172.16.6.194:20160</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  tikv</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          172.16.6.194</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  20160/20180</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  linux/x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      /home/data/tidb-home/data/tikv-20160</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         /home/data/tidb-deploy/tikv-20160</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">172.16.6.196:20160</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  tikv</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          172.16.6.196</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  20160/20180</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  linux/x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      /home/data/tidb-home/data/tikv-20160</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         /home/data/tidb-deploy/tikv-20160</span></span></code></pre></div><p>        <strong>TiCDC 在 4.0.6 版本 GA，建议使用 4.0.6 及以后的版本</strong>，详情参考 --&gt; <a href="https://docs.pingcap.com/zh/tidb/stable/scale-tidb-using-tiup#%E6%89%A9%E5%AE%B9-ticdc-%E8%8A%82%E7%82%B9" target="_blank" rel="noreferrer">TiCDC 官方文档</a>，扩容步骤如下。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@Linux-Hostname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$ cat scale-out-cdc.yaml </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cdc_servers:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> host:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.16.6.155</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    gc-ttl:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 86400</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    data_dir:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/deploy/install/data/cdc-8300</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> host:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.16.6.196</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    gc-ttl:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 86400</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    data_dir:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/deploy/install/data/cdc-8300</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@Linux-Hostname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$ tiup cluster scale-out tidb-test scale-out-cdc.yaml</span></span></code></pre></div><h3 id="_4-2-同步至-kafka" tabindex="-1">4.2 同步至 Kafka <a class="header-anchor" href="#_4-2-同步至-kafka" aria-label="Permalink to &quot;4.2 同步至 Kafka&quot;">​</a></h3><p>        由于本人之前没接触过 kafka ,本着熟悉 TiCDC 也要了解其周边工具的目的，从 <a href="https://kafka.apache.org/intro" target="_blank" rel="noreferrer">kafka 官网</a> 进行了简单入门，如有任何正确性问题可及时评论区交流。<br>          <strong>简单了解后，个人觉得 kafka 类似 GoLang 中的 Channel，区别在于提供了高性能的、分布式的、高可用的、弹性的、容错的、安全的 “事件流平台” 服务。</strong> kafka 官网介绍其事件流式处理机制如下图所示，Topic 作为分发消费的逻辑单元，Partition 作为最小存储单元，以 Hash Key 或其他策略将 Event 划分到多个 Partition 中，提供高吞吐性能。</p><figure><img src="`+k+`" alt="06TiCDC_DataFlow_Model" tabindex="0"><figcaption>06TiCDC_DataFlow_Model</figcaption></figure><p>        下面简单试用下 kafka，操作步骤如下，目的为从 kafka 中解析出 TiCDC 分发给 kafka 的消息，不深入研究 kafka 体系及调优。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装 Java 运行环境</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@kafka1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$ yum install java-1.8.0-openjdk.x86_64</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@kafka1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$ java -version</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openjdk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> version</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;1.8.0_322&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 依据 kafka quickstart 在 172.16.6.155、172.16.6.196 两个 server 架起 kafka</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@kafka1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$  wget https://dlcdn.apache.org/kafka/3.1.0/kafka_2.13-3.1g/kafka/3.1.0/kafka_2.13-3.1.0.tgz --no-check-certificate</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@kafka1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$  tar -xzf kafka_2.13-3.1.0.tgz</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@kafka1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$  cd kafka_2.13-3.1.0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@kafka1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$  bin/zookeeper-server-start.sh config/zookeeper.properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@kafka1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$  bin/kafka-server-start.sh config/server.properties</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建 partition 为 2、topic-name 为 tidb-test 的 topic</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@kafka1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$  bin/kafka-topics.sh --create --topic tidb-test </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    --bootstrap-server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  172.16.6.155:9092,172.16.6.196:9092</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    --partitions</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Created</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> topic</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> quickstart-events.</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看 topic-name 为 tidb-test 的 topic 的配置情况，可以看到 partition 为 2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@kafka1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$ bin/kafka-topics.sh --describe --topic tidb-test </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    --bootstrap-server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 172.16.6.155:9092,172.16.6.196:9092</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Topic:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tidb-test</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TopicId:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> OjM6FFrBQtqyEB4sVWmYCQ</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PartitionCount:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ReplicationFactor:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Configs:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> segment.bytes=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1073741824</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Topic:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tidb-test</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Partition:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Leader:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Replicas:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Isr:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Topic:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tidb-test</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Partition:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Leader:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Replicas:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Isr:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建 TiCDC 到 kafka 的 changefeed 同步,并复用手动创建的 tidb-test topic</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@kafka1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$ tiup cdc cli changefeed create --pd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://172.16.6.155:2379</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    --sink-uri=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;kafka://172.16.6.155:9092/tidb-test?protocol=canal-json&amp;kafka-version=2.4.0&amp;partition-num=2&amp;max-message-bytes=67108864&amp;replication-factor=1&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tiup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> checking</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> updates</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> component</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cdc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Starting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> component</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cdc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/tidb/.tiup/components/cdc/v6.0.0/cdc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/tidb/.tiup/components/cdc/v6.0.0/cdc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cli</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> changefeed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --pd=http://172.16.6.155:2379</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --sink-uri=kafka://172.16.6.155:9092/tidb-test</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">protocol=canal-json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&amp;kafka-version</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">2.4.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&amp;partition-num</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&amp;max-message-bytes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">67108864</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&amp;replication-factor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[2022/05/12 16:37:09.667 +08:00] [WARN] [kafka.go:416] [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;topic&#39;s \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max.message.bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\` less than the \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max-message-bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`,use topic&#39;s \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max.message.bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\` to initialize the Kafka producer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] [max.message.bytes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">1048588] [max-message-bytes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">67108864]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[2022/05/12 16:37:09.667 +08:00] [WARN] [kafka.go:425] [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;topic already exist, TiCDC will not create the topic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] [topic</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tidb-test] [detail</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">NumPartitions</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:2,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ReplicationFactor</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:1,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ReplicaAssignment</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:[0],</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:[0]},</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ConfigEntries</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">segment.bytes</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1073741824</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> changefeed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> successfully!</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 利用 sysbench 向 jan.sbtest1 中插入 2 行数据   </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@kafka1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$ sysbench oltp_read_write --mysql-host</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">127.0.0.1</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    --mysql-port=4000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    --mysql-db=jan</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    --mysql-user=root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    --mysql-password=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    --table_size=2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    --tables=1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  prepare</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 从 kafka 中解析 TiDB 的数据变更如下   </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@kafka1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$ bin/kafka-console-consumer.sh --topic tidb-test </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    --from-beginning</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --bootstrap-server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 172.16.6.155:9092,172.16.6.196:9092</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;id&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:0,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;database&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;jan&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;table&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;sbtest1&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;pkNames&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;id&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">],</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;isDdl&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:false,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;type&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;INSERT&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;es&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:1652344970654,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;ts&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:1652344977538,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;sql&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;sqlType&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">c</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:1,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:4,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">k</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:4,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pad</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:1},&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysqlType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:{&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">c</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">char</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">k</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pad</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">char</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;},&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">data</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:[{&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">c</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">83868641912-28773972837-60736120486-75162659906-27563526494-20381887404-41576422241-93426793964-56405065102-33518432330</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">k</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pad</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">67847967377-48000963322-62604785301-91415491898-96926520291</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;}],&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">old</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:null}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">{&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:0,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">database</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jan</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">table</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sbtest1</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pkNames</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:[&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;],&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isDdl</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:false,&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">INSERT</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">es</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:1652344970654,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ts</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:1652344977538,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sql</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sqlType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:{&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">c</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:1,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:4,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">k</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:4,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pad</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:1},&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysqlType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:{&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">c</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">char</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">k</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pad</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">char</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;},&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">data</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:[{&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">c</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">38014276128-25250245652-62722561801-27818678124-24890218270-18312424692-92565570600-36243745486-21199862476-38576014630</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">k</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pad</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">23183251411-36241541236-31706421314-92007079971-60663066966</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;}],&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">old</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:null}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">{&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:0,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">database</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jan</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">table</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pkNames</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:null,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isDdl</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:true,&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">QUERY</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">es</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:1652344966953,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ts</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:1652344969305,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sql</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CREATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DATABASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sqlType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:null,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysqlType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:null,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">data</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:null,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">old</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:null}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">{&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:0,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">database</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jan</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">table</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sbtest1</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pkNames</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:null,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isDdl</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:true,&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CREATE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">es</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:1652344970604,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ts</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:1652344975305,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sql</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CREATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sbtest1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> INT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NOT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NULL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> AUTO_INCREMENT,\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">k</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> INT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> _UTF8MB4&#39;0&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NOT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NULL,\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CHAR(120</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> _UTF8MB4&#39;&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NOT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NULL,\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pad</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CHAR(60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) DEFAULT _UTF8MB4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NOT NULL,PRIMARY KEY(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) ENGINE = innodb&quot;,&quot;sqlType&quot;:null,&quot;mysqlType&quot;:null,&quot;data&quot;:null,&quot;old&quot;:null}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;id&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:0,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;database&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;jan&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;table&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;sbtest1&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;pkNames&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:null,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;isDdl&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:true,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;type&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;CINDEX&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;es&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:1652344973455,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;ts&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:1652344978504,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;sql&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;CREATE INDEX </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">k_1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ON </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sbtest1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">k</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">)&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;sqlType&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:null,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;mysqlType&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:null,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;data&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:null,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;old&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:null}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 实验结束清理 172.16.6.155、172.16.6.196 两个 server 架起 kafka 环境</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 首先 ctrl + c 关闭所有终端启动的前台进程</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@kafka1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$ rm -rf /tmp/kafka-logs /tmp/zookeeper</span></span></code></pre></div><h3 id="_4-3-同步至-mysql" tabindex="-1">4.3 同步至 MySQL <a class="header-anchor" href="#_4-3-同步至-mysql" aria-label="Permalink to &quot;4.3 同步至 MySQL&quot;">​</a></h3><p>        在 <code>172.16.6.155:3306</code> 本地装个 MySQL，指定相关参数后便可创建订阅任务，id 为 simple-replication-task，在 Grafana 监控面板中可观察到同步进度。MySQL 对于 DBA 讲一定是较为熟悉的工具，因此验证同步等步骤便不赘述。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[tidb@Linux-Hostname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$ tiup cdc cli changefeed create --pd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://172.16.6.155:2379</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --sink-uri=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mysql://jan:123123@172.16.6.155:3306/?time-zone=&amp;worker-count=16&amp;max-txn-row=5000&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --changefeed-id=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;simple-replication-task&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --sort-engine=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;unified&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --config=changefeed.toml</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tiup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> checking</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> updates</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> component</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cdc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Starting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> component</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cdc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/tidb/.tiup/components/cdc/v6.0.0/cdc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/tidb/.tiup/components/cdc/v6.0.0/cdc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cli</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> changefeed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --pd=http://172.16.6.155:2379</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --sink-uri=mysql://jan:123123@172.16.6.155:3306/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">time-zone=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&amp;worker-count</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&amp;max-txn-row</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --changefeed-id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">simple-replication-task</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --sort-engine</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">unified</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">changefeed.toml</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[2022/04/12 16:58:40.954 +08:00] [WARN] [mysql_params.go:143] [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;max-txn-row too large&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] [original</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">5000] [override</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">2048]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> changefeed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> successfully!</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">......</span></span></code></pre></div><h2 id="五、引用文章" tabindex="-1">五、引用文章 <a class="header-anchor" href="#五、引用文章" aria-label="Permalink to &quot;五、引用文章&quot;">​</a></h2><p><a href="https://www.bilibili.com/video/BV1HT4y1A7mh?spm_id_from=333.337.search-card.all.click" target="_blank" rel="noreferrer">1. 【PingCAP Infra Meetup】No.131 Why and how we build TiCDC</a><br><a href="https://www.bilibili.com/video/BV1bD4y1o7qU?spm_id_from=333.337.search-card.all.click" target="_blank" rel="noreferrer">2. 【PingCAP Infra Meetup】No.131 TiCDC 的生态和社区建设</a><a href="https://docs.pingcap.com/zh/tidb/stable/ticdc-overview" target="_blank" rel="noreferrer">3. 官方文档 -- TiCDC</a><br><a href="https://docs.pingcap.com/zh/tidb/stable/tidb-binlog-overview" target="_blank" rel="noreferrer">4. 官方文档 -- TiDB Binlog</a><br><a href="https://docs.pingcap.com/zh/tidb/stable/handle-tidb-binlog-errors#%E5%BD%93%E4%B8%8A%E6%B8%B8%E4%BA%8B%E5%8A%A1%E8%BE%83%E5%A4%A7%E6%97%B6pump-%E6%8A%A5%E9%94%99-rpc-error-code--resourceexhausted-desc--trying-to-send-message-larger-than-max-2191430008-vs-2147483647" target="_blank" rel="noreferrer">5. 官方 FAQ -- Pump 的 gRPC message 超过限值</a><br><a href="https://github.com/pingcap/tiflow/blob/master/docs/design/2020-11-04-ticdc-protocol-list.md#protocols-%E5%88%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D" target="_blank" rel="noreferrer">6. Github Design Doc -- TiCDC 支持的消息队列输出协议指南</a><br><a href="https://github.com/pingcap/tiflow/projects/13" target="_blank" rel="noreferrer">7. Github Question and Bug Reports -- TiCDC 提升性能规划路径</a><br><a href="https://tidb.net/blog/2fa9cf6a" target="_blank" rel="noreferrer">8. AskTUG Blog -- 代晓磊 TiCDC 应用场景解析</a><a href="https://kafka.apache.org/intro" target="_blank" rel="noreferrer">9. 官方文档 -- Kafka</a></p><p>此外，AskTUG 作为 TiDB 官方支持生态社区，建议大家来<a href="https://tidb.net/blog/70588c4c" target="_blank" rel="noreferrer">这里 https://tidb.net/blog/70588c4c</a> 一起讨论。</p>`,35)]))}const u=n(F,[["render",r]]);export{c as __pageData,u as default};
